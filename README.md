# Redis-TCP
## Описание проекта
Приложение - аналог Redis, база данных, хранение данных в которой осуществляется в RAM. Система команд позволяет осуществить сохранение БД в файл дампа, а также выгрузить данные из указанного файла. 
Реализованы сервер и клиент. Сервер работает в многопоточном режиме.

## Использованные технологии
* **С++ 17** (Обусловлено использованием `std::shared_mutex` и `std::filesystem`)
* **CMake**
* **GTest Framework**
* **spdlog** (Выбор обусловлен высокой производительностью, потокобезопасностью, а также простотой конфигурации.)

## Общая архитектура проекта
### Сервер
Серверная часть приложения разделена на классы, которые отвечают за обработку различных частей логики.
Для запуска сервера необходимо передать 2 параметра - прослушиваемый порт и количество максимальных соединений соответственно.
Если указанный порт занят, то сервер перебирает все значения в интервале от `49152` до `65535` и пытается запуститься на них.
Если все порты заняты - аварийное отключение.

### Описание классов

* **ConnectionManager**
  - Класс, отвечающий за обработку входящих соединений. Инициализирует сокет для прослушивания с использованием `Winsock`, а также другие необходимые параметры для работы.
  - В основном цикле метода `run` ожидает входящие соединения, и если лимит подключний не превышен и всё корректно - выдает новому пользователю новый поток для обработки комманд.
  - Также для отправки клиенту состояния подключения используется структура `ConnectionStatus`, которая первым параметром содержит состояние подключения, а вторым сообщение пользователю:

      ```
      struct ConnectionStatus {
        bool connected;
        char message[256];
      };
      ```
  
* **CommandManager**
  - Класс, который отвечает за обработку команд в одтельном (для каждого пользователя) потоке.
  - По хорошему надо было бы распараллелить 3 операции - чтение команды, исполнение и отправку ответа, и использовать Thread Pools, но у меня не хватило времени (
  - Инициализирует доступные команды. На стороне сервера используется паттерн `Command` для полиморфизма и инкапсуляции логики работы внутри соответствующих классов.
  - Все команды реализованы в отдельных классах.
  - Протокол взаимодействия - строка, оканчивающаяся либо символом LF (0x0A), либо комбинацией CR LF (0x0D 0x0A). Все проверки на соответствие протоколу реализованы.
  - Система команд:
    - `PUT <key> <value>` - положить данные в БД.
    - `GET <key>` - получить значение по ключу `key`.
    - `DEL <key>` - удалить значение хранящееся в ключе `key`.
    - `COUNT` - вернуть общее число ключей в хранилище.
    - `DUMP <filename>` - выгрузить всё содержимое БД в файл дампа с именем `filename` (на стороне сервера). Формат хранения (\<key\>, \<value\>) для каждого ключа в новой строке.
    - `LOAD <filename>` - загрузить всё содержимое файла дампа c именем `filename` в БД. Если ключи уже существуют в хранилище, они перезаписываются.
    
* **DatabaseManager**
  - Класс, отвечающий за работу с хранилищем. Его методы вызываются через команды пользователей.
  - Все операции взаимодействия с БД синхронизированы при помощи механизма Readers–writer lock. Для реализации используются `std::unique_lock` и `std::shared_lock`.
  - В командах `DUMP` и `LOAD` реализованы проверки на некорректный формат файлов (\<key\>,\<value\>), на попытки чтения/записи из несуществующих/существующих файлов и т.д.
    
* **LoggingManager**
  - Класс, отвечающий за инициализацию логгера **spdlog**
  - Уровни логгирования debug, info, warn, error, critical.
  - Логгирование производится одновременно в консоль и файл `logs.txt`.
    
**Тесты**
- Unit тесты написаны при помощи **GTest**.
- Протестированы все основные аспекты работы приложения, а также все возможные крайние случаи методов и логики работы приложения.
- Есть использование Test Fixtures.

### Пример работы сервера
![image](https://github.com/tekassh1/Redis-TCP/assets/90504722/32c8bee7-4ee1-4f63-9fd0-0df9b381530f)

### Пример работы клиента
![image](https://github.com/tekassh1/Redis-TCP/assets/90504722/ad7673d3-2797-4cdc-8092-e5483959d80a)


